\input texinfo    @c -*- texinfo -*-
@c %**start of header
@setfilename org-roam.info
@settitle Org-roam User Manual
@documentencoding UTF-8
@documentlanguage en
@c %**end of header

@copying
@quotation
Copyright (C) 2020-2020 Jethro Kuan <jethrokuan95@@gmail.com>

You can redistribute this document and/or modify it under the terms
of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any
later version.

This document is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE@.  See the GNU
General Public License for more details.

@end quotation
@end copying

@dircategory Emacs
@direntry
* Org-roam: (org-roam). Rudimentary Roam Replica for Emacs.
@end direntry

@finalout
@titlepage
@title Org-roam User Manual
@subtitle for version 1.1.1
@author Jethro Kuan
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@contents

@ifnottex
@node Top
@top Org-roam User Manual

@noindent
This manual is for Org-roam version 1.1.1.

@quotation
Copyright (C) 2020-2020 Jethro Kuan <jethrokuan95@@gmail.com>

You can redistribute this document and/or modify it under the terms
of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any
later version.

This document is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE@.  See the GNU
General Public License for more details.

@end quotation
@end ifnottex

@menu
* Introduction::
* Installation::
* Getting Started::
* Anatomy of an Org-roam File::
* The Templating System::
* Configuration::
* Roam Protocol::
* Keystroke Index::
* Command Index::
* Function Index::
* Variable Index::
* Appendix::

@detailmenu
--- The Detailed Node Listing ---

Installation

* Installing from MELPA::
* Installing from the Git Repository::
* Post-Installation Tasks::

Anatomy of an Org-roam File

* File Aliases::
* File Refs::

The Templating System

* Org-roam Template Expansion::
* Template examples::

Configuration

* Setting the Org-roam Directory::
* Org-roam Buffer::
* Org-roam Links::
* Org-roam Files::
* Org-roam Graph Viewer::
* Org-roam Completion System::

Setting the Org-roam Directory

* Having More Than One Org-roam Directory::


Org-roam Files

* Index::
* Encryption::


Org-roam Graph Viewer

* Excluding Nodes and Edges::


Roam Protocol

* Installation: Installation (1). 
* The @samp{roam-file} protocol::
* The @samp{roam-ref} Protocol::

Appendix

* Note-taking Workflows::
* Ecosystem::

Ecosystem

* Deft::
* Org-journal::
* Note-taking Add-ons::


@end detailmenu
@end menu

@node Introduction
@chapter Introduction

Org-roam is a @uref{https://roamresearch.com/, Roam Research} replica built around the
all-powerful @uref{https://orgmode.org/, Org-mode}.

Org-roam is a solution for effortless non-hierarchical note-taking
with Org-mode. With Org-roam, notes flow naturally, making note-taking
fun and easy. Org-roam should also work as a plug-and-play solution
for anyone already using Org-mode for their personal wiki.

To understand more about Roam, a collection of links are available in
@ref{Note-taking Workflows}.

Org-roam aims to implement the core features of Roam, leveraging the
mature ecosystem around Org-mode where possible. Eventually, we hope
to further introduce features enabled by the Emacs ecosystem.

Org-roam provides several benefits over other tooling:

@table @asis
@item Privacy and Security
Edit your personal wiki completely offline, entirely in your control. Encrypt your notes with GPG@.
@item Longevity of Plain Text
Unlike web solutions like Roam research, the notes are first and foremost plain Org-mode files -- Org-roam simply builds up an auxilliary database to give the personal wiki superpowers. Having your notes in plain-text is crucial for the longevity of your wiki. Never have to worry about proprietary web solutions being taken down. Edit your plain-text notes in notepad if all other editors cease to exist
@item Free and Open Source
Org-roam is free and open-source, which means that if you feel unhappy with any part of Org-roam, you may choose to extend Org-roam, or open a PR@.
@item Leverages the Org-mode ecosystem
Over the years, Emacs and Org-mode has developed into a mature system for plain-text organization. Building upon Org-mode already puts Org-roam light-years ahead of many other solutions.
@item Built on Emacs
Emacs is also a fantastic interface for editing text, and we can inherit many of the powerful text-navigation and editing packages available to Emacs.
@end table

@node Installation
@chapter Installation

Org-roam can be installed using Emacs' package manager or manually from its development repository.

@menu
* Installing from MELPA::
* Installing from the Git Repository::
* Post-Installation Tasks::
@end menu

@node Installing from MELPA
@section Installing from MELPA

Org-roam is available from Melpa and Melpa-Stable. If you haven't used Emacs' package manager before, you may familiarize yourself with it by reading the documentation in the Emacs manual, see @ref{Packages,,,emacs,}. Then, add one of the archives to @samp{package-archives}:

@itemize
@item
To use Melpa:
@end itemize

@lisp
(require 'package)
(add-to-list 'package-archives
             '("melpa" . "http://melpa.org/packages/") t)
@end lisp

@itemize
@item
To use Melpa-Stable:
@end itemize

@lisp
(require 'package)
(add-to-list 'package-archives
             '("melpa-stable" . "http://stable.melpa.org/packages/") t)
@end lisp

Once you have added your preferred archive, you need to update the
local package list using:

@example
M-x package-refresh-contents RET
@end example

Once you have done that, you can install Org-roam and its dependencies
using:

@example
M-x package-install RET org-roam RET
@end example

Now see @ref{Post-Installation Tasks}.

@node Installing from the Git Repository
@section @strong{TODO} Installing from the Git Repository

@node Post-Installation Tasks
@section @strong{TODO} Post-Installation Tasks

@node Getting Started
@chapter @strong{TODO} Getting Started

Org-roam was built to support a workflow that was not possible with vanilla
Org-mode. This flow is modelled after the @uref{https://zettelkasten.de/, Zettelkasten Method}, and many of @uref{https://roamresearch.com, Roam Research's} workflows. It is crucial to understand that Org-roam does not
auto-magically make note-taking better -- it's changing the note-taking workflow
that does. To understand more about the methods and madness, see @ref{Note-taking Workflows}.

In Org-roam, your notes (or zettels), are stored in individual files, in the
@samp{org-roam-directory}. For this tutorial, create an empty directory, and set
@samp{org-roam-directory} accordingly:

@lisp
(make-directory "~/org-roam")
(setq org-roam-directory "~/org-roam")
@end lisp

Org-roam's entry point is the global minor @samp{org-roam-mode}. This sets up Emacs
with several hooks, for keeping the org-roam cache consistently updated, as well
as showing the backlinks buffer.

The cache is a sqlite database named @samp{org-roam.db}, which resides at the root
@samp{org-roam-directory}. Activating @samp{org-roam-mode} builds the cache, which may take a
while the first time, but is often instantaneous in subsequent runs. To build
the cache manually again, run @samp{M-x org-roam-db-build-cache}.

@samp{org-roam-find-file} shows the list of titles for notes that reside in
@samp{org-roam-directory}. Selecting a note title will bring you to the corresponding
note. Entering a title of a note that does not yet exist will create a new note
with that title.

@image{images/org-roam-find-file,,,,gif}

Note that in the above image, the @uref{https://github.com/abo-abo/swiper, Ivy} completion frontend is used. The default
frontend has some usability issues with non-matching candidates (e.g. when you
want to enter a title of a new note, there is no completion candidate), so
either Ivy or Helm is recommended.

@samp{org-roam-insert} insert links to existing (or new) notes. Entering a non-existent
title will also create a new note with that title.

@image{images/org-roam-insert-filetag,,,,gif}

Good usage of Org-roam requires liberally linking files. This allows
the build-up of a dense knowledge graph.

The Org-roam buffer is often displayed in the side window. It shows
backlinks for the currently active Org-roam note, along with some
surrounding context. To bring up toggle the visibility of this buffer, call @samp{M-x org-roam}.

@image{images/org-roam-buffer,,,,gif}

Org-roam also provides graphing capabilities, using Graphviz. It generates
graphs with notes as nodes, and links between them as edges. The generated graph
can be used to navigate to the files, but this requires some additional setup (see @ref{Roam Protocol}).

@image{images/org-roam-graph,,,,gif}

@node Anatomy of an Org-roam File
@chapter Anatomy of an Org-roam File

The bulk of Org-roam's functionality is built on top of vanilla
Org-mode. However, to support additional functionality, Org-roam adds
several Org-roam-specific keywords. These functionality are not crucial
to effective use of Org-roam.

@menu
* File Aliases::
* File Refs::
@end menu

@node File Aliases
@section File Aliases

Suppose you want a note to be referred to by different names (e.g.
"World War 2", "WWII"). You may specify such aliases using the
@samp{#+ROAM_ALIAS} attribute:

@example
#+TITLE: World War 2
#+ROAM_ALIAS: "WWII" "World War II"
@end example

@node File Refs
@section File Refs

Refs are unique identifiers for files. Each note can only have 1 ref.
For example, a note for a website may contain a ref:

@example
#+TITLE: Google
#+ROAM_KEY: https://www.google.com/
@end example

These keys come in useful for when taking website notes, using the
@samp{roam-ref} protocol (see @ref{Roam Protocol}).

Alternatively, add a ref for notes for a specific paper, using its
@uref{https://github.com/jkitchin/org-ref, org-ref} citation key:

@example
#+TITLE: Neural Ordinary Differential Equations
#+ROAM_KEY: cite:chen18_neural_ordin_differ_equat
@end example

The backlinks buffer will show any cites of this key: e.g.

@float Figure
@image{images/org-ref-citelink,,,,png}
@caption{org-ref-citelink}
@end float

@node The Templating System
@chapter The Templating System

Rather than creating blank files on @samp{org-roam-insert} and
@samp{org-roam-find-file}, it is may be desirable to prefill the file with
content. This may include:

@itemize
@item
Time of creation
@item
File it was created from
@item
Clipboard content
@item
Any other data you may want to input manually
@end itemize

This requires a complex template insertion system, but fortunately, Org
ships with a powerful one: @samp{org-capture}. However, org-capture was not
designed for such use. Org-roam abuses @samp{org-capture} to some extent,
extending its syntax. To first understand how org-roam's templating
system works, it may be useful to look into org-capture.

The org-roam capture template extends org-capture's template with 2
additional properties:

@enumerate
@item
@samp{:file-name}: This is the file name template used when a new note is
created. Notes can be placed in sub-directories by prepending them to
the filename (@samp{sub/file-name})
@item
@samp{:head}: This is the template that is inserted on initial note
creation.
@end enumerate

@menu
* Org-roam Template Expansion::
* Template examples::
@end menu

@node Org-roam Template Expansion
@section Org-roam Template Expansion

Org-roam's template definitions also extend org-capture's template
syntax, to allow prefilling of strings. In many scenarios,
@samp{org-roam--capture} is passed a mapping between variables and strings.
For example, during @samp{org-roam-insert}, a title is prompted for. If the
title doesn't already exist, we would like to create a new file, without
prompting for the title again.

Variables passed are expanded with the @samp{$@{var@}} syntax. For example,
during @samp{org-roam-insert}, @samp{$@{title@}} is prefilled for expansion. Any
variables that do not contain strings, are prompted for values using
@samp{completing-read}.

After doing this expansion, the org-capture's template expansion system
is used to fill up the rest of the template. You may read up more on
this on @uref{https://orgmode.org/manual/Template-expansion.html#Template-expansion, org-capture's documentation page}.

For example, take the template: @samp{"%<%Y%m%d%H%M%S>-$@{title@}"}, with the
title @samp{"Foo"}. The template is first expanded into
@samp{%<%Y%m%d%H%M%S>-Foo}. Then org-capture expands @samp{%<%Y%m%d%H%M%S>} with
timestamp: e.g. @samp{20200213032037-Foo}.

All of the flexibility afforded by emacs and org-mode are available. For
example, if you want to encode a UTC timestamp in the filename, you can
take advantage of org-mode's @samp{%(EXP)} template expansion to call
@samp{format-time-string} directly to provide its third argument to specify
UTC@.

@lisp
("d" "default" plain (function org-roam--capture-get-point)
     "%?"
     :file-name "%(format-time-string \"%Y-%m-%d--%H-%M-%SZ--$@{slug@}\" (current-time) t)"
     :head "#+TITLE: $@{title@}\n"
     :unnarrowed t)
@end lisp

Similarly, if you want to change how titles are transformed into slugs,
you can override @samp{org-roam--title-to-slug}. For example, to use hyphens
instead of underscores:

@lisp
(defun org-roam--title-to-slug (title)
  "Convert TITLE to a filename-suitable slug. Uses hyphens rather than underscores."
  (cl-flet* ((nonspacing-mark-p (char)
                                (eq 'Mn (get-char-code-property char 'general-category)))
             (strip-nonspacing-marks (s)
                                     (apply #'string (seq-remove #'nonspacing-mark-p
                                                                 (ucs-normalize-NFD-string s))))
             (cl-replace (title pair)
                         (replace-regexp-in-string (car pair) (cdr pair) title)))
    (let* ((pairs `(("[^[:alnum:][:digit:]]" . "-")  ;; convert anything not alphanumeric
                    ("--*" . "-")  ;; remove sequential underscores
                    ("^-" . "")  ;; remove starting underscore
                    ("-$" . "")))  ;; remove ending underscore
           (slug (-reduce-from #'cl-replace (strip-nonspacing-marks title) pairs)))
      (s-downcase slug))))
@end lisp

This templating system is used throughout org-roam templates.

@node Template examples
@section Template examples

Here I walkthrough the default template, reproduced below.

@lisp
("d" "default" plain (function org-roam--capture-get-point)
     "%?"
     :file-name "%<%Y%m%d%H%M%S>-$@{slug@}"
     :head "#+TITLE: $@{title@}\n"
     :unnarrowed t)
@end lisp

@enumerate
@item
The template has short key @samp{"d"}. If you have only one template,
org-roam automatically chooses this template for you.
@item
The template is given a description of @samp{"default"}.
@item
@samp{plain} text is inserted. Other options include Org headings via
@samp{entry}.
@item
@samp{(function org-roam--capture-get-point)} should not be changed.
@item
@samp{"%?"} is the template inserted on each call to @samp{org-roam--capture}.
This template means don't insert any content, but place the cursor
here.
@item
@samp{:file-name} is the file-name template for a new note, if it doesn't
yet exist. This creates a file at path that looks like
@samp{/path/to/org-roam-directory/20200213032037-foo.org}.
@item
@samp{:head} contains the initial template to be inserted (once only), at
the beginning of the file. Here, the title global attribute is
inserted.
@item
@samp{:unnarrowed t} tells org-capture to show the contents for the whole
file, rather than narrowing to just the entry.
@end enumerate

Other options you may want to learn about include @samp{:immediate-finish}.

@node Configuration
@chapter Configuration

The number of configuration options is deliberately kept small, to keep
the Org-roam codebase manageable. However, we attempt to accommodate as
many usage styles as possible.

All of Org-roam's customization options can be viewed via
@samp{M-x customize-group org-roam}.

@menu
* Setting the Org-roam Directory::
* Org-roam Buffer::
* Org-roam Links::
* Org-roam Files::
* Org-roam Graph Viewer::
* Org-roam Completion System::
@end menu

@node Setting the Org-roam Directory
@section Setting the Org-roam Directory

Set @samp{org-roam-directory} to the folder containing all your Org files:

@lisp
(setq org-roam-directory "/path/to/org/")
@end lisp

Every Org file, at any level of nesting, within @samp{/path/to/org/} is
considered part of the Org-roam ecosystem.

@menu
* Having More Than One Org-roam Directory::
@end menu

@node Having More Than One Org-roam Directory
@subsection Having More Than One Org-roam Directory

Emacs supports directory-local variables, allowing the value of
@samp{org-roam-directory} to be different in different directories. It does
this by checking for a file named @samp{.dir-locals.el}.

To add support for multiple directories, override the
@samp{org-roam-directory} variable using directory-local variables. This is
what @samp{.dir-locals.el} may contain:

@lisp
((nil . ((org-roam-directory . "/path/to/here/"))))
@end lisp

All files within that directory will be treated as their own separate
set of Org-roam files. Remember to run @samp{org-roam-db-build-cache} from a
file within that directory, at least once.

@node Org-roam Buffer
@section Org-roam Buffer

The Org-roam buffer defaults to popping up from the right. You may
choose to set it to pop up from the left with
@samp{(setq org-roam-buffer-position 'left)}.

The Org-roam buffer name can also be renamed:
e.g. =(setq org-roam-buffer "@strong{my-buffer-name}")=.

The Org-roam buffer width is adjustable via @samp{org-roam-buffer-width}. The
value of @samp{org-roam-buffer-width} set as a percentage of the total frame
width. For example:

@lisp
(setq org-roam-buffer-width 0.4)
@end lisp

Will result in the Org-roam buffer taking up 40% of the screen width.

You can change backlinks appearance in the buffer by customizing
@samp{org-roam-backlink} face (@samp{M-x customize-face org-roam-backlink}).

@node Org-roam Links
@section Org-roam Links

By default, links are inserted with the title as the link description.
This can make them hard to distinguish from external links. You may
choose add special indicators for Org-roam links by tweaking
@samp{org-roam-link-title-format}, for example:

@lisp
(setq org-roam-link-title-format "R:%s")
@end lisp

If your version of Org is at least @samp{9.2}, you may also choose to simply
style the link differently, by customizing @samp{org-roam-link} face
(@samp{M-x customize-face org-roam-link}).

@node Org-roam Files
@section Org-roam Files

Org-roam files are created and prefilled using Org-roam's templating
system. The templating system is customizable (see @ref{The Templating System}).

@menu
* Index::
* Encryption::
@end menu

@node Index
@subsection Index

As your collection grows, you might want to create an index where you
keep links to your main files.

In Org-roam, you can define the path to your index file by setting
@samp{org-roam-index-file}.

@lisp
(setq org-roam-index-file "index.org")
@end lisp

You can then bind @samp{org-roam-find-index} in your configuration to access
it.

@node Encryption
@subsection Encryption

Encryption (via GPG) can be enabled for all new files by setting
@samp{org-roam-encrypt-files} to @samp{t}. When enabled, new files are created
with the @samp{.org.gpg} extension and decryption are handled automatically
by EasyPG@.

Note that Emacs will prompt for a password for encrypted files during
cache updates if it requires reading the encrypted file. To reduce the
number of password prompts, you may wish to cache the password.

@node Org-roam Graph Viewer
@section Org-roam Graph Viewer

Org-roam generates an SVG image using @uref{https://graphviz.org/, Graphviz}. To setup graph navigation, see @ref{Roam Protocol}.

Org-roam tries its best to locate the Graphviz executable from your
@samp{PATH}, but if it fails to do so, you may set it manually:

@example
(setq org-roam-graph-executable "/path/to/dot")
@end example

You may also choose to use @samp{neato} in place of @samp{dot}, which generates a
more compact graph layout.

@example
(setq org-roam-graph-executable "/path/to/neato")
(setq org-roam-graph-extra-config '(("overlap" . "false")))
@end example

Org-roam also attempts to use Firefox (located on @samp{PATH}) to view the
SVG, you may choose to set it to any compatible program:

@example
(setq org-roam-graph-viewer "/path/to/image-viewer")
@end example

@menu
* Excluding Nodes and Edges::
@end menu

@node Excluding Nodes and Edges
@subsection Excluding Nodes and Edges

One may want to exclude certain files to declutter the graph. You can do
so by setting @samp{org-roam-graph-exclude-matcher}.

@example
(setq org-roam-graph-exclude-matcher '("private" "dailies"))
@end example

This setting excludes all files whose path contain "private" or
"dailies".

@node Org-roam Completion System
@section Org-roam Completion System

Org-roam offers completion when choosing note titles etc. The completion
system is configurable. The default setting,

@lisp
(setq org-roam-completion-system 'default)
@end lisp

uses Emacs' standard @samp{completing-read}. If you prefer
@uref{https://emacs-helm.github.io/helm/, Helm}, use

@lisp
(setq org-roam-completion-system 'helm)
@end lisp

Other options include @samp{'ido}, and @samp{'ivy}.

@node Roam Protocol
@chapter Roam Protocol

Org-roam extending @samp{org-protocol} with 2 protocols: the @samp{roam-file}
and @samp{roam-ref} protocol.

@menu
* Installation: Installation (1). 
* The @samp{roam-file} protocol::
* The @samp{roam-ref} Protocol::
@end menu

@node Installation (1)
@section Installation

To enable Org-roam's protocol extensions, you have to add the following to your init file:

@lisp
(require 'org-roam-protocol)
@end lisp

The instructions for setting up @samp{org-protocol=} are reproduced below.

We will also need to create a desktop application for @samp{emacsclient}. The
instructions for various platforms are shown below.

For Linux users, create a desktop application in @samp{~/.local/share/applications/org-protocol.desktop}:

@example
[Desktop Entry]
Name=Org-Protocol
Exec=emacsclient %u
Icon=emacs-icon
Type=Application
Terminal=false
MimeType=x-scheme-handler/org-protocol
@end example

Associate @samp{org-protocol://} links with the desktop application by
running in your shell:

@example
xdg-mime default org-protocol.desktop x-scheme-handler/org-protocol
@end example

To disable the "confirm" prompt in Chrome, you can also make Chrome
show a checkbox to tick, so that the @samp{Org-Protocol Client} app will be used
without confirmation. To do this, run in a shell:

@example
sudo mkdir -p /etc/opt/chrome/policies/managed/
sudo tee /etc/opt/chrome/policies/managed/external_protocol_dialog.json >/dev/null <<'EOF'
@{
  "ExternalProtocolDialogShowAlwaysOpenCheckbox": true
@}
EOF
sudo chmod 644 /etc/opt/chrome/policies/managed/external_protocol_dialog.json
@end example

and then restart Chrome (for example, by navigating to <chrome://restart>) to
make the new policy take effect.

See @uref{https://www.chromium.org/administrators/linux-quick-start, here} for more info on the @samp{/etc/opt/chrome/policies/managed} directory and
@uref{https://cloud.google.com/docs/chrome-enterprise/policies/?policy=ExternalProtocolDialogShowAlwaysOpenCheckbox, here} for information on the @samp{ExternalProtocolDialogShowAlwaysOpenCheckbox} policy.

For MacOS, one solution is to use @uref{https://github.com/sveinbjornt/Platypus, Platypus}. Here are the instructions for
setting up with Platypus and Chrome:

@enumerate
@item
Install and launch Platypus (with @uref{https://brew.sh/, Homebrew}):
@end enumerate

@example
brew cask install platypus
@end example

@enumerate
@item
Create a script @samp{launch_emacs.sh}:
@end enumerate

@example
#!/usr/bin/env bash
/usr/local/bin/emacsclient --no-wait $1
@end example

@enumerate
@item
Create a Platypus app with the following settings:
@end enumerate

@example
| Setting                        | Value                     |
|--------------------------------+---------------------------|
| App Name                       | "OrgProtocol"             |
| Script Type                    | "env" · "/usr/bin/env"    |
| Script Path                    | "path/to/launch-emacs.sh" |
| Interface                      | None                      |
| Accept dropped items           | true                      |
| Remain running after execution | false                     |
@end example


Inside @samp{Settings}:

@example
| Setting                        | Value          |
|--------------------------------+----------------|
| Accept dropped files           | true           |
| Register as URI scheme handler | true           |
| Protocol                       | "org-protocol" |
@end example

To disable the "confirm" prompt in Chrome, you can also make Chrome
show a checkbox to tick, so that the @samp{OrgProtocol} app will be used
without confirmation. To do this, run in a shell:

@example
defaults write com.google.Chrome ExternalProtocolDialogShowAlwaysOpenCheckbox -bool true
@end example


If you're using @uref{https://github.com/railwaycat/homebrew-emacsmacport, Emacs Mac Port}, it registered its `Emacs.app` as the default
handler for the URL scheme `org-protocol`. To make @samp{OrgProtocol.app}
the default handler instead, run:

@example
defaults write com.apple.LaunchServices/com.apple.launchservices.secure LSHandlers -array-add \
'@{"LSHandlerPreferredVersions" = @{ "LSHandlerRoleAll" = "-"; @}; LSHandlerRoleAll = "org.yourusername.OrgProtocol"; LSHandlerURLScheme = "org-protocol";@}'
@end example

Then restart your computer.

@node The @samp{roam-file} protocol
@section The @samp{roam-file} protocol

This is a simple protocol that opens the path specified by the @samp{file}
key (e.g. @samp{org-protocol://roam-file?file=/tmp/file.org}). This is used
in the generated graph.

@node The @samp{roam-ref} Protocol
@section The @samp{roam-ref} Protocol

This protocol finds or creates a new note with a given @samp{ROAM_KEY} (see @ref{Anatomy of an Org-roam File}):

@image{images/roam-ref,,,,gif}

To use this, create a Firefox bookmarklet as follows:

@example
javascript:location.href =
'org-protocol://roam-ref?template=r&ref='
+ encodeURIComponent(location.href)
+ '&title='
+ encodeURIComponent(document.title)
@end example

or as a keybinding in @samp{qutebrowser}, adding the following to the @samp{autoconfig.yml} file:

@example
settings:
  bindings.commands:
    global:
      normal:
        gc: open javascript:void(location.href='org-protocol://roam-ref?template=r&ref='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title))
@end example

where @samp{template} is the template key for a template in
@samp{org-roam-capture-ref-templates} (see @ref{The Templating System}). These templates
should contain a @samp{#+ROAM_KEY: $@{ref@}} in it.

@node Keystroke Index
@appendix Keystroke Index

@printindex ky

@node Command Index
@appendix Command Index

@printindex cp

@node Function Index
@appendix Function Index

@printindex fn

@node Variable Index
@appendix Variable Index

@printindex vr

@node Appendix
@chapter Appendix

@menu
* Note-taking Workflows::
* Ecosystem::
@end menu

@node Note-taking Workflows
@section Note-taking Workflows

@table @asis
@item Books
@itemize
@item
@uref{https://www.goodreads.com/book/show/34507927-how-to-take-smart-notes, How To Take Smart Notes}
@end itemize
@item Articles
@itemize
@item
@uref{https://www.lesswrong.com/posts/NfdHG6oHBJ8Qxc26s/the-zettelkasten-method-1, The Zettelkasten Method - LessWrong 2.0}
@item
@uref{https://reddit.com/r/RoamResearch/comments/eho7de/building_a_second_brain_in_roamand_why_you_might, Building a Second Brain in Roam@dots{}And Why You Might Want To : RoamResearch}
@item
@uref{https://www.nateliason.com/blog/roam, Roam Research: Why I Love It and How I Use It - Nat Eliason}
@item
@uref{https://twitter.com/adam_keesling/status/1196864424725774336?s=20, Adam Keesling's Twitter Thread}
@item
@uref{https://blog.jethro.dev/posts/how_to_take_smart_notes_org/, How To Take Smart Notes With Org-mode · Jethro Kuan}
@end itemize
@item Threads
@itemize
@item
@uref{https://news.ycombinator.com/item?id=22473209, Ask HN: How to Take Good Notes}
@end itemize
@item Videos
@itemize
@item
@uref{https://www.youtube.com/watch?v=RvWic15iXjk, How to Use Roam to Outline a New Article in Under 20 Minutes}
@end itemize
@end table

@node Ecosystem
@section Ecosystem

A number of packages work well combined with Org-Roam:

@menu
* Deft::
* Org-journal::
* Note-taking Add-ons::
@end menu

@node Deft
@subsection Deft

@uref{https://jblevins.org/projects/deft/, Deft} provides a nice interface
for browsing and filtering org-roam notes.

@lisp
(use-package deft
  :after org
  :bind
  ("C-c n d" . deft)
  :custom
  (deft-recursive t)
  (deft-use-filter-string-for-filename t)
  (deft-default-extension "org")
  (deft-directory "/path/to/org-roam-files/"))
@end lisp

If the title of the Org file is not the first line, you might not get
nice titles. You may choose to patch this to use @samp{org-roam}'s
functionality. Here I'm using
@uref{https://github.com/raxod502/el-patch, el-patch}:

@lisp
(use-package el-patch
  :straight (:host github
                   :repo "raxod502/el-patch"
                   :branch "develop"))

(eval-when-compile
  (require 'el-patch))

(use-package deft
  ;; same as above...
  :config/el-patch
  (defun deft-parse-title (file contents)
    "Parse the given FILE and CONTENTS and determine the title.
If `deft-use-filename-as-title' is nil, the title is taken to
be the first non-empty line of the FILE.  Else the base name of the FILE is
used as title."
    (el-patch-swap (if deft-use-filename-as-title
                       (deft-base-filename file)
                     (let ((begin (string-match "^.+$" contents)))
                       (if begin
                           (funcall deft-parse-title-function
                                    (substring contents begin (match-end 0))))))
                   (org-roam--get-title-or-slug file))))
@end lisp

The Deft interface can slow down quickly when the number of files get
huge. @uref{https://github.com/hasu/notdeft, Notdeft} is a fork of Deft
that uses an external search engine and indexer.

@node Org-journal
@subsection Org-journal

@uref{https://github.com/bastibe/org-journal, Org-journal} is a more
powerful alternative to the simple function @samp{org-roam-dailies-today}. It
provides better journaling capabilities, and a nice calendar interface
to see all dated entries.

@lisp
(use-package org-journal
  :bind
  ("C-c n j" . org-journal-new-entry)
  :custom
  (org-journal-date-prefix "#+TITLE: ")
  (org-journal-file-format "%Y-%m-%d.org")
  (org-journal-dir "/path/to/org-roam-files/")
  (org-journal-date-format "%A, %d %B %Y"))
@end lisp

@node Note-taking Add-ons
@subsection Note-taking Add-ons

These are some plugins that make note-taking in Org-mode more enjoyable.

@menu
* Org-download::
* mathpix.el: mathpixel. 
* Org-noter / Interleave::
* Bibliography::
* Spaced Repetition::
@end menu

@node Org-download
@unnumberedsubsubsec Org-download

@uref{https://github.com/abo-abo/org-download, Org-download} lets you
screenshot and yank images from the web into your notes:

@float Figure
@image{images/org-download,,,,gif}
@caption{org-download}
@end float

@lisp
(use-package org-download
  :after org
  :bind
  (:map org-mode-map
        (("s-Y" . org-download-screenshot)
         ("s-y" . org-download-yank))))
@end lisp

@node mathpixel
@unnumberedsubsubsec mathpix.el

@uref{https://github.com/jethrokuan/mathpix.el, mathpix.el} uses
@uref{https://mathpix.com/, Mathpix's} API to convert clips into latex
equations:

@float Figure
@image{images/mathpix,,,,gif}
@caption{mathpix}
@end float

@lisp
(use-package mathpix.el
  :straight (:host github :repo "jethrokuan/mathpix.el")
  :custom ((mathpix-app-id "app-id")
           (mathpix-app-key "app-key"))
  :bind
  ("C-x m" . mathpix-screenshot))
@end lisp

@node Org-noter / Interleave
@unnumberedsubsubsec Org-noter / Interleave

@uref{https://github.com/weirdNox/org-noter, Org-noter} and
@uref{https://github.com/rudolfochrist/interleave, Interleave} are both
projects that allow synchronised annotation of documents (PDF, EPUB
etc.) within Org-mode.

@node Bibliography
@unnumberedsubsubsec Bibliography

@uref{https://github.com/zaeph/org-roam-bibtex, org-roam-bibtex} offers
tight integration between
@uref{https://github.com/jkitchin/org-ref, org-ref},
@uref{https://github.com/tmalsburg/helm-bibtex, helm-bibtex} and
@samp{org-roam}. This helps you manage your bibliographic notes under
@samp{org-roam}.

@node Spaced Repetition
@unnumberedsubsubsec Spaced Repetition

@uref{https://github.com/l3kn/org-fc/, Org-fc} is a spaced repetition
system that scales well with a large number of files. Other alternatives
include
@uref{https://orgmode.org/worg/org-contrib/org-drill.html, org-drill}, and
@uref{https://github.com/abo-abo/pamparam, pamparam}.

Emacs 28.0.50 (Org mode 9.3)
@bye
